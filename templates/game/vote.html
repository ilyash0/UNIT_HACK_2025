{% extends 'base.html' %}
{% load static %}

{% block title %}Страница показа ответов игроков{% endblock %}

{% block content %}
<div class="grid">
    <div class="cell lt">
        {% if players.0 %}
            {{ players.0 }}
        {% else %}
            Игрок1
        {% endif %}
    </div>

    <div class="cell lm">
        {% if players.0 %}
            Ответ игрока 1
        {% else %}
            Фу, тут мусором воняет!
        {% endif %}
    </div>

    <div class="cell lb">
        #1
    </div>

    <div class="center">
        Фраза, которую не стоит говорить, сидя в полицейской буханке_______
    </div>

    <div class="cell rt">
        {% if players.1 %}
            {{ players.1 }}
        {% else %}
            Игрок2
        {% endif %}
    </div>

    <div class="cell rm">
        {% if players.1 %}
            Ответ игрока 2
        {% else %}
            Мужики, а пописать можно выйти?
        {% endif %}
    </div>

    <div class="cell rb">
        #2
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    console.log('Script loaded'); // Тестовая проверка
    const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    const socket = new WebSocket(protocol + window.location.host + '/ws/players/');

    socket.onopen = function() {
        console.log('WebSocket connected');
    };

    socket.onmessage = function(event) {
        console.log('WebSocket message received:', event.data);
        const data = JSON.parse(event.data);
        if (data.all_voted) {
            console.log('All voted, redirecting to /win/');
            window.location.href = '/win/';
        }
    };

    socket.onerror = function(error) {
        console.error('WebSocket error:', error);
    };

    socket.onclose = function(event) {
        console.log('WebSocket closed:', event);
    };
</script>
{% endblock %}