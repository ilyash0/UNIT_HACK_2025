{% extends 'base.html' %}
{% load static %}

{% block title %}Ожидание игроков{% endblock %}

{% block content %}
    <div class="waiting-container">
        <div class="overlay"></div>

        <div class="content">
            <h1 class="title">OЖИДАНИЕ ИГРOКOВ</h1>

            <div id="players-list" class="players-list" style="border: none; background-color: transparent;">
                {% for player in players %}
                    <div class="player-card">
                        {{ player }}
                    </div>
                {% endfor %}
            </div>

            <div class="qr-container">
                <img src="{% static 'images/qr.png' %}" alt="QR-код для подключения">
            </div>

            <div class="loading">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <script>
        const list = document.getElementById('players-list');
        const socket = new WebSocket(
            'ws://' + window.location.host + '/ws/players/'
        );

        socket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            if (data.type === 'new_player') {
                const div = document.createElement('div');
                div.textContent = data.player.username;
                div.dataset.id = data.player.id;
                div.classList.add("player-card")
                list.append(div);
            }
        };
    </script>
{% endblock %}